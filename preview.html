<!doctype html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>CMS Renderer Test</title>
  </head>
  <body>
    <button onclick="loadRenderer()">Load Renderer</button>
    <div id="cms-content"></div>

    <script>
      // æ¸¬è©¦è³‡æ–™
      const testData = {
        children: [
          {
            id: 'text-1',
            type: 'text',
            props: {
              content: 'ğŸ‰ CMS æ¸²æŸ“å™¨è¼‰å…¥æˆåŠŸï¼',
              fontSize: 24,
              color: '#333333',
              size: { width: 400, height: 40 },
            },
            children: [],
            parentId: null,
          },
        ],
      };

      async function loadRenderer() {
        try {
          // è¼‰å…¥ manifest
          console.log('ğŸ“¦ è¼‰å…¥æ§‹å»ºæª”æ¡ˆ');
          const manifest = await fetch('/manifest.json').then(r =>
            r.json()
          );
          console.log('Manifest:', manifest);

          // ç²å–æ¸²æŸ“å™¨æª”æ¡ˆåç¨±
          const fileName = manifest['src/domains/renderer/standaloneRenderer.ts'].file;
          console.log('Renderer file:', fileName);

          // å‹•æ…‹è¼‰å…¥ script (IIFE format, ä¸éœ€è¦ type="module")
          return new Promise((resolve, reject) => {
            const script = document.createElement('script');
            script.src = `/${fileName}`;
            script.onload = () => {
              console.log('âœ… æ¸²æŸ“å™¨è¼‰å…¥æˆåŠŸ');

              // æ¸²æŸ“ï¼ˆoptions: { root }ï¼‰
              window.cmsAppRenderer('cms-content', { root: testData });
              resolve();
            };
            script.onerror = reject;
            document.head.appendChild(script);
          });
        } catch (error) {
          console.error('âŒ è¼‰å…¥å¤±æ•—:', error);
        }
      }
      window.loadRenderer = loadRenderer;
    </script>
  </body>
</html>
